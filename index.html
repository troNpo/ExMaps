<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ExMaps</title>
  <!--manifest.json-->
<link rel="manifest" href="manifest.json" />
  <!-- Estilos -->
  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet para mapas -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Geocoder plugin para Nominatim -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
</head>
<body>
    
    <!-- botón menú flotante -->
        <button id="toggleBotonera" class="toggle-botonera" title="Mostrar/Ocultar barra">
  <img src="icons/ui/fi-sr-brain-circuit.svg" alt="Toggle" />
</button>
    
    <!-- botonera lateral  -->
  <div id="barraControles" class="barra-lateral">
  <!-- 📍 Buscar lugar (Nominatim) -->
  <div class="bloque-boton">
    <button id="btnBuscarLugar" title="Buscar lugar" class="btnLateral">
      <img src="icons/ui/fi-sr-land-location.svg" alt="Buscar lugar" />
    </button>
    <span>Ubicación</span>
  </div>
  <!-- capas -->
<div class="bloque-boton">
  <button id="btnPanelCapas" class="btnLateral" title="Capas del mapa">
    <img src="icons/ui/fi-sr-layers.svg" alt="Capas">
  </button>
  <span>Capas</span>
</div>

  <!-- ➕ Zoom in  -->
  <div class="bloque-boton">
    <button id="btnZoomIn" title="Acercar mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-zoom-in.svg" alt="Zoom +" />
    </button>
     <span>zoom</span>
  </div>
 

  <!-- ➖ Zoom out  -->
  <div class="bloque-boton">
    <button id="btnZoomOut" title="Alejar mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-zoom-out.svg" alt="Zoom -" />
    </button>
  </div>

  <!-- 🍔 Categorías -->
  <div class="bloque-boton">
    <button id="menuBtn" title="Abrir panel" class="btnLateral">
      <img src="icons/ui/fi-sr-category.svg" alt="Menú" />
    </button>
    <span>Categorías</span>
  </div>

  
  <!-- 🔄 Actualizar búsqueda -->
  <div class="bloque-boton">
    <button id="btnBusquedaDirecta" title="Buscar desde mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-search-location.svg" alt="Buscar desde mapa" />
    </button>
    <span>Actualizar</span>
  </div>
  
  <!--  Botón Limpiar mapa -->
<div class="bloque-boton">
  <button title="Limpiar mapa" class="btnLateral" onclick="limpiarMapa()">
    <img src="icons/ui/fi-sr-eraser.svg" alt="Limpiar mapa" />
  </button>
  <span>Limpiar</span>
</div>

<!-- ajustes  -->
<div class="bloque-boton">
  <button id="btnAjustesMapa" title="Ajustes del mapa" class="btnLateral">
    <img src="icons/ui/fi-sr-square-ellipsis.svg" alt="Ajustes" />
  </button>
  <span>Opciones</span>
</div>
<!-- ❔ Botón de ayuda -->
<div class="bloque-boton">
  <button id="btnAyudaMapa" title="Abrir ayuda" class="btnLateral" onclick="abrirAyuda()">
    <img src="icons/ui/fi-sr-question-square.svg" alt="Ayuda sobre la app" />
  </button>
  <span>Ayuda</span>
</div>
</div>

<!-- Menú emergente que se abre al pulsar el botón de ajustes -->
<div id="menuAjustes" class="menu-emergente">

  <button class="cerrarMenu" onclick="cerrarAjustes()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar ajustes" />
  </button>

  <!-- Sección de usuario -->
  <button onclick="abrirPerfilUsuario()" class="btn-opcion">
    <img src="icons/ui/fi-sr-user-gear.svg" alt="Perfil de usuario" />
    Perfil de usuario
  </button>
  
  <!-- 🧭 Exportación directa KML -->
  <button onclick="exportarMapaKML(construirPoisPorCategoria())" class="btn-opcion">
    <img src="icons/ui/fi-sr-folder-download.svg" alt="Exportar mapa KML" />
    Exportar todos los POIs del mapa
  </button>

  <button onclick="exportarPOIsSeleccionados()" class="btn-opcion">
    <img src="icons/ui/fi-sr-file-download.svg" alt="Exportar seleccionados KML" />
    Exportar Capa personalizada 
  </button>
<!-- Sección avanzada -->
  <button onclick="abrirConfiguracionAvanzada()" class="btn-opcion">
    <img src="icons/ui/fi-sr-settings.svg" alt="Configuración avanzada" />
    Con.avanzada
  </button>
</div>

<!-- Panel búsqueda Nominatim -->
<div id="panelResultadosNominatim" class="menu-emergente" >
  
  <!-- ❌ Botón cerrar -->
  <button class="btnVolverPanel" onclick="cerrarPanelResultados()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar panel" />
  </button>

  <!-- 🧭 Título de búsqueda -->
  <label>
    <img src="icons/ui/fi-sr-land-location.svg" alt="Icono ubicación" />
    Buscar ubicación
  </label>

  <!-- 🔍 Barra de búsqueda -->
  <div class="busqueda-wrap">
    <input type="text" id="inputDireccion" placeholder="📍 Escribe una dirección..." />
    <button id="btnBuscarDireccion">Buscar</button>
  </div>

  <!-- 📋 Título de resultados -->
  <label>
    <img src="icons/ui/fi-sr-list.svg" alt="Icono lista" />
    Resultados
  </label>

  <!-- 📍 Área de resultados -->
  <div id="resultadosNominatim"></div>
</div>    

<!-- Panel flotante para el perfil de usuario -->
<div id="menuPerfilUsuario" class="menu-emergente">
 <button class="btnVolverPanel cerrarMenu" onclick="cerrarPerfilUsuario()">
  <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar panel" />
</button>

  <h3>Preferencias</h3>

  <div class="bloque-config">
    <label for="ubicacionDefecto">
      <img src="icons/ui/fi-sr-home-location-alt.svg" alt="Ubicación" />
      Ubicación por defecto
    </label>
    <input type="text" id="ubicacionDefecto" placeholder="Ej. Sevilla, España" />
    <button onclick="buscarUbicacion()">Buscar ubicación</button>
    <small id="ubicacionConfirmada"></small>
  </div>

  <div class="bloque-config">
    <label for="modoUso">
      <img src="icons/ui/fi-sr-mobile-hand.svg" alt="Modo de uso" />
      Modo de uso
    </label>
    <select id="modoUso">
      <option value="diestro">Diestro</option>
      <option value="zurdo">Zurdo</option>
    </select>
  </div>

  <button onclick="guardarPreferenciasUsuario()">✅ Guardar preferencias</button>
</div>


  <!-- 📂 Panel lateral -->
  <div id="sidebar" class="sidebar hidden">
    <div id="logoExMaps">
  <img src="icons/logo512.png" alt="Logo ExMaps" />
</div>  
    <!-- 🏷️ Título de la app -->
    <div id="nombreApp">Puntos de Interés</div> 
    
    <!-- 🧭 Panel principal de selección de categorías -->
 <div id="panelCategorias" class="subpanel visible">
  <button class="btnVolverPanel soloIcono" onclick="cerrarPanelCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Cerrar panel">
  </button>
  <h2>Explorar categorías</h2>
  <button class="btnBuscarPanel">🔍 Buscar seleccionados</button>
  <button id="btnLimpiarSeleccion" class="btnSecundario">
  🧹 Limpiar selección
</button>
  
  <div class="grupo-categorias">
    <button onclick="mostrarCategoria('ciclismo_senderismo')">🚶 Ciclismo y senderismo</button>
    <button onclick="mostrarCategoria('alojamiento')">🛏️ Alojamiento</button>
    <button onclick="mostrarCategoria('comodidades')">🚿 Comodidades</button>
    <button onclick="mostrarCategoria('emergencias')">🚨 Emergencias</button>
    <button onclick="mostrarCategoria('naturaleza')">🌿 Naturaleza</button>
    <button onclick="mostrarCategoria('ocio_turismo')">🎭 Ocio y turismo</button>
    <button onclick="mostrarCategoria('servicios')">🛠️ Servicios</button>
    <button onclick="mostrarCategoria('transporte')">🚉 Transporte</button>
  </div>
</div>
<div id="panelalojamiento" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🛏️ Alojamiento</h2>
   <button class="btnBuscarPanel" id="btnBuscarAlojamiento">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="alpine_hut">
      Refugio de montaña
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="wilderness_hut">
      Refugio básico
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="camp_site">
      Camping
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="caravan_site">
      Caravanas
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="hostel">
      Albergue / Hostel
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="guest_house">
      Casa de huéspedes
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="hotel">
      Hotel
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="chalet">
      Chalet
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="apartment">
      Apartamento turístico
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="motel">
      Motel
    </label>
  </div>
</div>
  <div id="panelciclismo_senderismo" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🚶 Ciclismo y senderismo</h2>
   <button class="btnBuscarPanel" id="btnBuscarRutaActiva">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label>
      <input type="checkbox" class="poicheck" data-cat="information" data-sub="guidepost">
      Poste de ruta
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="information" data-sub="trailhead">
      Inicio de ruta
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bicycle_repair_station">
      Reparación bici
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="charging_station">
      Punto de carga
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="picnic_site">
      Zona picnic
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="firepit">
      Zona fuego
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="shelter">
      Refugio sencillo
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="information" data-sub="guidepost">
      Señal guía
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="information" data-sub="board">
      Panel informativo
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="information" data-sub="terminal">
      Terminal digital
    </label>
  </div>
</div>

<div id="panelcomodidades" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🚿 Comodidades</h2>
  <button class="btnBuscarPanel" id="btnBuscarComodidades">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="drinking_water">
      Agua potable
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="toilets">
      Aseos públicos
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bench">
      Banco
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="lounger">
      Tumbona
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fountain">
      Fuente
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="recycling">
      Punto reciclaje
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="shelter">
      Refugio cómodo
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="public_bath">
      Baño público / termal
    </label>
  </div>
</div>

<div id="panelemergencias" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🚨 Emergencias</h2>
    <button class="btnBuscarPanel" id="btnBuscarEmergencias">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="hospital">
      Hospital
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="pharmacy">
      Farmacia
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="doctors">
      Centro médico / doctor
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="emergency_phone">
      Teléfono de emergencia
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="emergency_access_point">
      Punto de acceso médico
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="defibrillator">
      Desfibrilador
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="police">
      Policía
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fire_station">
      Bomberos
    </label>
  </div>
</div>

<div id="panelnaturaleza" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🌿 Naturaleza</h2>
  <button class="btnBuscarPanel" id="btnBuscarNaturaleza">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="tree">
      Árbol destacado
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="spring">
      Manantial
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="waterfall">
      Cascada
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="cave_entrance">
      Cueva
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="rock">
      Formación rocosa
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="cliff">
      Acantilado
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="volcano">
      Volcán
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="peak">
      Pico
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="saddle">
      Collado
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="mountain_pass">
      Paso montañoso
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="viewpoint">
      Mirador
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="boundary" data-sub="protected_area">
      Área protegida
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="leisure" data-sub="botanical_garden">
      Jardín botánico
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="natural" data-sub="beach">
      Playa
    </label>
    <label>
      <input type="checkbox" class="poicheck" data-cat="leisure" data-sub="park">
      Parque
    </label>
  </div>
</div>

<div id="panelocio_turismo" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🎭 Ocio y turismo</h2>
   <button class="btnBuscarPanel" id="btnBuscarOcioTurismo">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="museum"> Museo</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="gallery"> Galería de arte</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="cinema"> Cine</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="theatre"> Teatro</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="castle"> Castillo</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="ruins"> Ruinas</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="monument"> Monumento</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="memorial"> Memorial</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="artwork"> Arte público</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="sculpture"> Escultura</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="library"> Biblioteca</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="public_bookcase"> Estantería pública</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="zoo"> Zoológico</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="attraction"> Atracción turística</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="wayside_shrine"> Altar</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="wayside_cross"> Cruz histórica</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="archaeological_site"> Sitio arqueológico</label>

    <!-- 🍽️ Experiencia culinaria -->
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="restaurant"> Restaurante</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fast_food"> Comida rápida</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="cafe"> Cafetería</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bar"> Bar</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="pub"> Pub / cervecería</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="biergarten"> Biergarten</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="ice_cream"> Heladería</label>
  </div>
</div>

<div id="paneltransporte" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🚉 Transporte</h2>
   <button class="btnBuscarPanel" id="btnBuscarTransporte">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <label><input type="checkbox" class="poicheck" data-cat="highway" data-sub="bus_stop"> Parada de bus</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bus_station"> Estación de bus</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="subway_entrance"> Entrada a metro</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="train_station"> Estación de tren</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="station"> Estación ferroviaria</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="ferry_terminal"> Terminal ferry</label>
    <label><input type="checkbox" class="poicheck" data-cat="aerialway" data-sub="station"> Estación de teleférico</label>
    <label><input type="checkbox" class="poicheck" data-cat="aeroway" data-sub="airport"> Aeropuerto</label>
    <label><input type="checkbox" class="poicheck" data-cat="aeroway" data-sub="helipad"> Helipuerto</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="parking"> Aparcamiento</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="parking_entrance"> Entrada a parking</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="crossing"> Cruce ferroviario</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="level_crossing"> Paso a nivel</label>
  </div>
</div>
<div id="panelservicios" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>🛠️ Servicios</h2>
    <button class="btnBuscarPanel" id="btnBuscarServicios">🔍 Buscar POIs</button>
  <div class="contenedorFiltros">
    <!-- 🛒 Comercio -->
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="supermarket"> Supermercado</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="convenience"> Tienda de conveniencia</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="bakery"> Panadería</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="organic"> Tienda ecológica</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="butcher"> Carnicería</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="sports"> Tienda deportiva</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="bicycle"> Bicicletas</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="books"> Librería</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="chemist"> Perfumería / Botica</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="doityourself"> Bricolaje / Ferretería</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="travel_agency"> Agencia de viajes</label>

    <!-- 💸 Finanzas y comunicación -->
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="atm"> Cajero automático</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bank"> Banco</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="post_office"> Oficina de correos</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="post_box"> Buzón</label>

    <!-- 🧺 Otros -->
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="laundry"> Lavandería</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fuel"> Gasolinera</label>
  </div>
</div>

  </div> <!-- #sidebar -->

  <!-- 🗺️ Mapa principal -->
  <div id="map"></div>

 <div id="panelPoi" class="bottom-sheet hidden">
  <!-- 📎 Grip superior -->
  <div class="grip"></div>

  <!-- 🔘 Botón cerrar -->
  <button class="btn-cerrar" id="cerrarPanelPoi" title="Cerrar panel">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar" />
  </button>

  <!-- 🔼 Botón expandir -->
  <button class="expandir-btn" id="btnExpandirPanel" title="Expandir panel">
    <img src="icons/ui/fi-sr-expand.svg" alt="Expandir" />
  </button>

  <!-- 📄 Contenido del POI -->
  <div class="contenido-poi">
    <h2 id="poiNombre">POI</h2>
    <div id="poiDatos"></div>
    
    <!-- 🎯 Botones de funciones -->
<div class="acciones-poi">
  <button class="accion-btn" id="btnCompartir" title="Compartir">
    <img src="icons/ui/fi-sr-share.svg" alt="Compartir" />
  </button>
  <button class="accion-btn" id="btnExportar" title="Exportar">
    <img src="icons/ui/fi-sr-download.svg" alt="Exportar" />
  </button>
  <button class="accion-btn" id="btnContribuirPOI" title="Contribuir">
    <img src="icons/ui/fi-sr-attribution-pencil.svg" alt="Contribuir" />
  </button>
  <button class="accion-btn" id="btnVisualizarPOI" title="Ver ubicación">
    <img src="icons/ui/fi-sr-overview.svg" alt="Visualizar POI" />
  </button>
</div>

 <!-- 📑 Menú compartir -->
<div class="menu-emergente" id="menuCompartir">
  <button onclick="compartirTextoPOI()">
    <img src="icons/ui/fi-sr-blog-text.svg" alt="Texto POI" />
    <span>Compartir como texto</span>
  </button>
  <button onclick="compartirPosicionPOI()">
    <img src="icons/ui/fi-sr-map-marker.svg" alt="Ubicación POI" />
    <span>Compartir posición en otra app</span>
  </button>
</div>

<!-- 📦 Menú exportar -->
<div class="menu-emergente" id="menuExportar">
  <button onclick="exportarPOIIndividual(window.tagsPOI)">
    <img src="icons/ui/fi-sr-clip.svg" alt="Icono exportar POI" />
    <span>Exportar este POI como KML</span>
  </button>
</div>

<!-- 🤝 Menú contribuir -->
<div class="menu-emergente" id="menuContribuir">
    <button class="cerrarMenuContribuir" aria-label="Cerrar panel">
  <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar" />
</button>
  <div class="guia-osm">
    <p>💡 ¿Qué puedo aportar aquí?</p>
    <ul>
      <li>📍 El lugar no tiene nombre o categoría</li>
      <li>⚠️ Está cerrado, abandonado o ya no existe</li>
      <li>🚫 Acceso bloqueado o error en ubicación</li>
      <li>✏️ Faltan detalles: horario, servicios, tipo</li>
      <li>📸 No aparece en el mapa, pero sí en la realidad</li>
    </ul>
    <p>
      Tus sugerencias se publican como <strong>nota pública</strong> en OSM.<br />
      No necesitas cuenta, pero puedes iniciar sesión si lo deseas.<br />
      Los editores revisan estas notas para mejorar el mapa 🙌
    </p>
  </div>

  <button onclick="abrirEditorOSM()">
    <img src="icons/ui/fi-sr-code-editing.svg" alt="Editor OSM" />
    <span>Editar directamente en OpenStreetMap</span>
  </button>

  <button onclick="añadirNotaOSM()">
    <img src="icons/ui/fi-sr-blog-pencil.svg" alt="Añadir nota OSM" />
    <span>Añadir sugerencia como nota pública</span>
  </button>
</div>

<!-- 🗺️ Menú ver ubicación -->
<div class="menu-emergente" id="menuVer">
  <button onclick="abrirStreetViewDesdePOI()">
    <img src="icons/ui/fi-sr-street-view.svg" alt="Street View" />
    <span>Ver en Street View</span>
  </button>

  <button onclick="abrirMapillaryDesdePOI()">
    <img src="icons/ui/fi-sr-camera-viewfinder.svg" alt="Mapillary" />
    <span>Ver en Mapillary</span>
  </button>
</div>

  
  <!-- ⚙️ Script principal -->
  <script src="script.js" defer></script>
<!--  captura de pantalla -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('Service Worker registrado ✅'))
      .catch(err => console.error('Error al registrar SW', err));
  }
  </script>
</body>
</html>
